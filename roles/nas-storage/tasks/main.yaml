---
- name: Create nas mount directory if it does not exist
  ansible.builtin.file:
    path: /wunderhort
    state: directory
    owner: root
    group: root
    mode: '0755'

- name: Create nas mount directory if it does not exist
  ansible.builtin.file:
    path: /wunderhort/{{ item }}
    state: directory
    owner: leon
    group: leon
    mode: '0755'
  with_items: "{{ nas.wunderhort }}"


- name: Insert/Update NFS mount configuration into fstab and validate it
  ansible.builtin.blockinfile:
    block: "{{ lookup('ansible.builtin.file', 'fstab') }}"
    path: /etc/fstab
    backup: yes
    validate: /usr/bin/findmnt -F %s
    append_newline: true
    prepend_newline: true
